<!-- Libery -->
<link rel="import" href="/public/lib/polymer/polymer.html">
<!-- Web Component -->
<link rel="import" href="/public/lib/byutv-jsonp/byutv-jsonp.html">

<dom-module id="facebook-login-button">
  <template>
    <style>
      .login-button {
        box-sizing: border-box;
        position: relative;
        /* width: 13em;  - apply for fixed size */
        margin: 0.2em;
        padding: 0 15px 0 46px;
        border: none;
        text-align: left;
        line-height: 34px;
        white-space: nowrap;
        border-radius: 0.2em;
        font-size: 16px;
        color: #FFF;
      }
      .login-button:before {
        content: "";
        box-sizing: border-box;
        position: absolute;
        top: 0;
        left: 0;
        width: 34px;
        height: 100%;
      }
      .login-button:focus {
        outline: none;
      }
      .login-button:active {
        box-shadow: inset 0 0 0 32px rgba(0,0,0,0.1);
      }


      /* Facebook */
      .login-button.--facebook {
        background-color: #4C69BA;
        background-image: linear-gradient(#4C69BA, #3B55A0);
        /*font-family: "Helvetica neue", Helvetica Neue, Helvetica, Arial, sans-serif;*/
        text-shadow: 0 -1px 0 #354C8C;
      }
      .login-button.--facebook:before {
        border-right: #364e92 1px solid;
        background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/14082/icon_facebook.png') 6px 6px no-repeat;
      }
      .login-button.--facebook:hover,
      .login-button.--facebook:focus {
        background-color: #5B7BD5;
        background-image: linear-gradient(#5B7BD5, #4864B1);
      }
    </style>
    <byutv-jsonp
      id="ajax"
      auto
      url=""
      on-response="handleResponse"
      callback-value="callback"
      debounce-duration="300">
    </byutv-jsonp>
    <button class="login-button --facebook" on-click="setAjax">
      Login with Facebook
    </button>
  </template>
  <script>
    Polymer({
      is: 'facebook-login-button',
      setAjax: function() {
        this.$.ajax.url = "/auth/facebook";
      },
      handleResponse: function(request) {
        res = this.$.ajax.lastResponse;
        if (res.success === true) {
          document.querySelector('main-layout').token = res.results.token;
          window.location = '/';
        } else if (res.code === 2) {
          window.location = '/signup?email=' + res.user.email
            + '&name=' + res.user.name
            + '&facebook=' + res.user.facebook
            + '&tokens=' + JSON.stringify(res.user.tokens)
            + '&picture=' + res.user.picture
        }
      }
    })
  </script>
</dom-module>