<!-- Libery -->
<link rel="import" href="/public/lib/polymer/polymer.html">
<!-- Web Component -->

<link rel="import" href="/public/lib/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/public/lib/paper-listbox/paper-listbox.html">
<link rel="import" href="/public/lib/paper-card/paper-card.html">
<link rel="import" href="/public/lib/paper-input/paper-textarea.html">
<link rel="import" href="/public/lib/vaadin-upload/vaadin-upload.html">
<link rel="import" href="/public/lib/google-map/google-map.html">
<link rel="import" href="/public/lib/google-map/google-map-marker.html">
<link rel="import" href="/public/lib/paper-dropdown-menu/paper-dropdown-menu.html">

<link rel="import" href="/components/zone-api/zone-api.html">
<link rel="import" href="/components/place-api/place-api.html">
<link rel="import" href="/components/shared-styles/shared-styles.html">

<dom-module id="zone-show-page">
  <template>
  <style is="custom-style" include="shared-styles">
    :host {
      @apply(--layout-vertical);
      @apply(--layout-center-center);
      padding-top: 20px;
    }

    paper-card {
      width: 100%;
    }

    .item {
      margin-bottom: 10px;
    }

    .avatar {
      display: inline-block;
      height: 40px;
      overflow: hidden;
      margin-right: 20px;
    }

    .flex-layout {
      @apply(--layout-horizontal);
    }
    .flex {
      @apply(--layout-flex);
    }
    .label {
      font-weight: 200;
      width: 100px;
      display: inline-block;
      margin-right: 20px;
    }
    .label.--upload {
      line-height: 70px;
    }

    .company {
      font-size: 20px;
      font-weight: 200;
    }
    google-map {
      height: 300px;
    }
    .google-map {
      display: block;
      height: 300px;
    }

    .button-holder {
      @apply(--layout-horizontal);
      @apply(--layout-end-justified);
      margin-top: 10px;
    }

    #main {
      min-height: 800px;
      margin: 0px;
      padding: 0px;
      display: flex;
      flex-flow: row;
    }

    #main > #left {
      margin: 4px;
      flex: 3 1 70%;
      min-width: 70%;
      order: 1;
    }

    #main > #right {
      flex: 3 1 30%;
      min-width: 30%;
      order: 2;
    }

    .card {
      margin: 4px;
      padding: 5px;
    }

    /* Too narrow to support three columns */
    @media all and (max-width: 800px) {
        #main {
            flex-direction: column;
        }

        #main > #left, #main > #right {
        /* Return them to document order */
            order: 0;
        }

        #main > #left, #main > #right {
            min-height: 50px;
        }
    }

    paper-button > a {
      color: #000;
      text-decoration: none;
      width: 100%;
    }

    .block {
      margin: 10px;
    }

    .deleteBtn {
      float: right;
      cursor: pointer;
    }

    .fitdiv {
      display: inline;
      word-wrap: break-word;
    }
  </style>
		<zone-api
			id="zoneAPI"
			zone-id="{{zoneId}}"
			fields=""
			page="0"
			page-size="0"
			zone="{{zone}}"
    ></zone-api>
    <div class="container">
      <paper-card class="card">
				<div class="card-content">
					<!-- type -->
					<div class="item">
						<label class="label --input">Type</label>
						<div class="flex fitdiv">
              {{zone.type}}
						</div>
					</div>
					<!-- websiteUrl -->
					<div class="item">
						<label class="label --input">Website URL</label>
						<div class="flex fitdiv">
              {{zone.website}}
						</div>
					</div>

					<!-- Thumbnail Upload -->
					<div class="item">
						<div class="flex-layout">
							<label class="label --upload">Thumbnail</label>
							<div class="flex fitdiv">
                <iron-image style="width:140px; height:80px;" sizing="cover" preload fade src="{{_computeThumbnail(zone.thumbnail)}}"></iron-image>
							</div>
						</div>
					</div>
					<!-- Banner Upload -->
					<div class="item">
						<div class="flex-layout">
							<label class="label --upload">Banner</label>
              <div class="flex fitdiv">
                <iron-image style="width:200px; height:150px;" sizing="cover" preload fade src="{{_computeBanner(zone.banner)}}"></iron-image>
							</div>
						</div>
					</div>

					<!-- Google Map -->
					<div class="item google-map">
						<google-map latitude="[[zone.location.latitude]]" longitude="[[zone.location.longitude]]" zoom="[[zoom]]" api-key="AIzaSyDqaDUBa0p8qYiWDwjYUlxkInJuwgTxD1o" fit>
							<google-map-marker latitude="{{zone.location.latitude}}" longitude="{{zone.location.longitude}}" draggable="false"
									title="Zone Location!" ></google-map-marker>
						</google-map>
					</div>
				</div>
				<div class="card-content">
					<!-- Thai Language -->
					<div class="flex-layout center">
						<div class="avatar" item-icon><img src="/public/img/th.png" /></div>
						<div class="flex company">ภาษาไทย</div>
					</div>

					<div class="item">
            <label class="label --input">ชื่อ</label>
            <div class="flex fitdiv">
              {{zone.name.th}}
						</div>
          </div>
					<div class="item">
            <label class="label --input">ชื่อย่อ</label>
            <div class="flex fitdiv">
              {{zone.shortName.th}}
						</div>
          </div>
					<div class="item">
            <label class="label --input">ข้อความต้อนรับ</label>
            <div class="flex fitdiv">
              {{zone.welcomeMessage.th}}
						</div>
          </div>
					<div class="item">
            <label class="label --input">รายละเอียด</label>
            <div class="flex fitdiv">
              {{zone.description.th}}
						</div>
          </div>
				</div>
				<div class="card-content">
					<!-- English Language -->
					<div class="flex-layout center">
						<div class="avatar" item-icon><img src="/public/img/en.png" /></div>
						<div class="flex company">English</div>
					</div>

					<div class="item">
            <label class="label --input">name</label>
            <div class="flex fitdiv">
              {{zone.name.en}}
						</div>
          </div>
					<div class="item">
            <label class="label --input">shortname</label>
            <div class="flex fitdiv">
              {{zone.shortName.en}}
						</div>
          </div>
					<div class="item">
            <label class="label --input">welcome message</label>
            <div class="flex fitdiv">
              {{zone.welcomeMessage.en}}
						</div>
          </div>
					<div class="item">
            <label class="label --input">description</label>
            <div class="flex fitdiv">
              {{zone.description.en}}
						</div>
          </div>
				</div>
      </paper-card>
      <paper-card class="card">
        <h3>Place</h3>
        <template is="dom-repeat" items="{{places}}">
          <div class="block">
            <paper-card-dataitem action image="http://icons.iconarchive.com/icons/awicons/vista-artistic/256/office-building-icon.png">

              <div class="card-item-header">
              <h4>  {{item.name.en}}</h4>
              <h5>CODE {{item.code}}</h5>

              </div>

            </paper-card-dataitem>
          </div>
        </template>
        <place-api id="placeAPI" url="[[urlPlace]]" places="{{places}}" error="{{error}}"></place-api>
      </paper-card>
    </div>
  </template>
<script>
    Polymer({
      is: 'zone-show-page',
      properties: {
				activated: {
					type: Boolean,
					value: false,
				},
				zoneId: {
          type: String,
          observer: '_idChanged'
        },
        token: {
          type: String,
        },
        zoom: {
          type: Number,
          value: 16
        },
				zone: {
					type: Object
				},
        places: {
          type: Array,
          value: [],
        },
        error: {
          type: Object,
        },
        urlPlace: {
          type: String,
          value: ''
        }
      },
      observers: [
        '_activatedChanged(activated, zoneId)',
      ],
      _activatedChanged: function(activated, zoneId) {
        if (activated) {
          var zoneRequest = this.$.zoneAPI.generateRequest();
          zoneRequest.completes.then(function() {
            this.$.placeAPI.generateRequest();
          }.bind(this));
        }
      },
      _response: function(e) {
        if (e.detail.response.success) {
          this.$.form.reset();
          this.$.placeAPI.generateRequest();
        }
      },
      _deleteClick: function(event) {
        var id = event.model.item['_id'];
        var url = window.api + '/api/places/' + id;

        var dom = this;
        setTimeout(function () {
          var req = new XMLHttpRequest();
          req.open('DELETE',encodeURI(url));
          req.onload = function() {
            if (req.status === 202) {
              dom.$.placeAPI.generateRequest();
            }
          };
          req.send();
        }.bind(this), 300);
      },
      _idChanged: function(id) {
        if (id && id!='show' && id!='edit' && id!='add' && id!='list') {
          this.urlPlace = window.api + '/api/places?zoneid=' + id ;
        } else {
          this.urlPlace = '';
        }
        this.$.placeAPI.generateRequest();
      },
			_computeThumbnail: function(thumbnail) {
				return window.api + thumbnail;
			},
			_computeBanner: function(banner) {
				return window.api + banner;
			}
    })
  </script>
</dom-module>
